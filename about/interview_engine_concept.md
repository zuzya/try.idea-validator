# Концепция Dual-Layer Interview Engine

Этот документ описывает архитектуру и ключевые преимущества нашего движка для симуляции проблемных интервью (CustDev). Мы отошли от простых линейных диалогов в пользу агентской системы с разделением ответственности и моделированием "скрытых мыслей".

## 1. Архитектура: Разделение Ролей

Наша система построена на взаимодействии трех специализированных агентов. Такое разделение позволяет каждой модели фокусироваться на своей узкой задаче, что повышает качество генерации.

### A. Recruiter Agent (Поиск и Обогащение)
**Логика:**
Вместо простой генерации "усредненной" персоны, мы используем двухэтапный процесс:
1.  **Vector Search:** Поиск реальных фрагментов интервью и профилей в нашей базе знаний по семантическому сходству с ролью (Vector DB).
2.  **LLM Enrichment:** Найденный "скелет" обогащается деталями (имя, возраст, софт, скрытые мотивы) с помощью LLM, создавая `RichPersona`.

**Почему это работает лучше:**
> Большинство симуляторов создают "Ивана, 30 лет, любит футбол".
> Наш Рекрутер создает "Ивана, 35 лет, который ненавидит Jira, боится увольнения и не имеет бюджета на внедрение ПО". Это задает реалистичные ограничения для интервью.

### B. Interviewer Agent (Исследователь)
**Логика:**
Не просто идет по списку вопросов. На каждом шаге (Turn) он:
1.  Анализирует предыдущий ответ респондента.
2.  Решает: ответ был честным или формальным?
3.  Выбирает стратегию: задать следующий вопрос из гайда или "копать глубже" (Digging Deeper), если ответ был уклончивым.

**Почему это работает лучше:**
> Статические скрипты не работают, когда пользователь отвечает односложно. Наш агент ведет себя как опытный продуктовый менеджер, вытягивая детали ("Почему?", "Сколько это стоило?").

### C. Persona Agent (Респондент с Двойным Дном)
**Логика:**
Самое важное нововведение — **Dual-Layer Architecture**. Персона моделирует два потока сознания:
1.  **Inner Thought (Внутренний голос):** Истинные мысли, настроение, уровень терпения. Здесь персона цинична, ленива и эгоистична.
2.  **Verbal Response (Речь):** Социально приемлемый ответ, который слышит интервьюер.

**Почему это работает лучше:**
> "The Mom Test Problem": Люди врут, чтобы быть вежливыми.
> Обычная LLM склонна быть "полезным ассистентом" и хвалить идею.
> Наша Dual-Layer модель может *думать* "Какая чушь, у меня нет на это времени", но *говорить* "Звучит интересно, держите в курсе". Это позволяет аналитику позже выявить ложные срабатывания (False Positives).

---

## 2. Механики Реалистичности

### Turn-by-Turn Loop (Пошаговая Симуляция)
Вместо генерации всего диалога одним промптом, мы запускаем Python-цикл (до 10 шагов).
*   **Преимущество:** Модели не "забывают" контекст к концу длинного диалога. Мы можем динамически менять состояние (настроение) на каждом шаге.

### Моделирование Терпения (Patience Meter)
У каждой персоны есть шкала терпения (0-100).
*   Глупые вопросы или непонимание контекста снижают терпение.
*   Если терпение падает ниже 10, персона вежливо (или грубо) прерывает интервью.
*   **Результат:** Это заставляет нас писать качественные гайды интервью, иначе мы не получаем данных.

### Rich Persona Context
Мы передаем в контекст персоны не только роль, но и:
*   `tech_stack`: Каким софтом уже пользуется (барьер переключения).
*   `hidden_constraints`: Скрытые мотивы (нет бюджета, лень учиться).
*   `frustrations`: Реальные боли из базы знаний.

---

## 3. Итоговый Анализ (Truth-Seeking)

В конце интервью Analyst Agent смотрит не только на то, что было сказано вслух, но и на **Inner Thoughts**.
*   Если респондент сказал "Куплю", но подумал "Лишь бы отстал", Аналитик пометит `Willingness to Pay` как низкий.
*   Это дает нам "Честную метрику" боли, очищенную от вежливости.

### Резюме: Почему это мощно?
Мы создали систему, которая **активно сопротивляется валидации**.
Она не пытается "помочь" пользователю подтвердить гипотезу. Наоборот, она моделирует реальную инерцию, скепсис и сложность человеческой коммуникации. Если идея выживает в этой среде — она действительно чего-то стоит.
